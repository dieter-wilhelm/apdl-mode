!(progn (when (featurep 'ansys-mode)(unload-feature 'ansys-mode))(setq ansys-highlighting-level 2)(load-file "ansys-mode.el")(ansys-mode))
f $ fi $ fin $ fini $ finis  $ finish $ finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Steel= 3
False = 0$True =1
*if,ARG9,eq,AR19,then ! ARG1-9, AR10-19 *use/commandline macro variables
  AR20 = 20 !AR20 - AR99 local macro variables
*endif
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans,'_otto' 
!! APDL get/parametricfunctions & old style (deprecated) Ansys comments
var1=sinh(cos(.3 *5)) !old style Ansys comments!!!!!
var2 = tan(nx(.3*5)) !not an old style Ansys comment
/xml		     ! undocumented command /xml
*afun,rad
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular

/com,hans holz !!!! this is really not commented out!!!!
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Steel = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands which do not allow arguments
/prep7 $ FINISH ! $ is nothing behind?
/prep7 !nothing behind?
/prep7 nothing behind allowed
rectngaaaaa,var1,_X2,var2,X2 ! 2d rectangle
nsel = 3	      !you CAN have such var names 
nsel,s,loc,y,nsel
    ,a,loc,y,nsel
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,var2
*endif
!!::: implicit : (colon) looping :::::
lfillt,(1:2),(3:4),5
*DOWHILE,PAR
*CYCLE, VAR2 _bla
  *cyc
  *cycl
  *exit
*enddo
! goto branching
*go,:BRANCH
aselsalsdkfjaölsdkfjaölskdjf,all
:branch
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
a $ al $ all $ alls $ allse $ allsel $ allselllllll

nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
alls
/pbc,all,on
!gplot
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------

fini $ /cle
/prep7

/title, this is just an example
Pi=acos(-1) $ True=1 $ False=0
Xc = 0 $ Yc = 0 
R1=4 $ R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
/com, === Material %Steel% is steel. ===

ID=Steel
et,ID,solid186 !3d, 20 node

nsel,s,loc,y,0
    ,a,loc,y,1
    ,r,loc,x,0
d,all,all
!dlist,all
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++
!! (setq font-lock-maximum-decoration '((ansys-mode . 1)))
!(progn (unload-feature 'ansys-mode)(load-file "ansys-mode.el")(ansys-mode)))
f
fi
fin
fini
finis 
finish
finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Copper= 3
False = 0$True =1
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans  '_otto'	 ! _vars: macro reserved words
*afun,rad
!! APDL get/parametricfunctions & old style (deprecated) Anys comments
var1=sinh(nx(.3 *5)) !old style Ansys comments!!!!!
var2 = tanh(cos(.3*5)) !not an old style Ansys comment
!! undocumented commands
/xml
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular
/com,hans holz ! this is really no comment
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Icoil = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands without arguments
/prep7 $ finish
/prep7 !nothing behind
/prep7 nothing behind
rect,X1,_X2,Y1,Y2 ! 2d rectangle
nsel,s,loc,y,0
    ,a,loc,y,1
d,all,all
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,10
*endif
!! implicit (colon) looping
lfillt,(1:2),(3:4),5
*dowhile,PAR
*cycle, bla _bla
*cyc
  *exit
*enddo
! goto branching
*go,:BRANCH
:BRANCH
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
vvv!! ====================
 
alsalsdkfjaölsdkfjaölskdjf 
nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------
!@@ -- cad import -- 

/aux15
ioptn,iges,nodefeat
ioptn,merge,yes
ioptn,solid,yes
ioptn,small,yes
ioptn,gtoler,defa
igesin,'test','iges'

/input,filename,anf ! for APDL based input
/facet,norm
!! ------------------------------
!@@ -- configurations --

! *afun,deg ! trig. functions accept angle arguments
*afun,rad
True = 1
False = 0

/title,
/plopts,wp,1 !display working plane
/triad,rbot !off, orig, ltop, ...
!/cwd,DIR !changes working directory
!! ------------------------------
!@@ -- geometry --

/prep7
rectng,X1,X2,Y1,Y2 ! 2d rectangle
!!arsym,y,all ! reflection of areas Xc = 0
Yc = 0
R1=4
R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder
!shpere,rad1,rad2,th1,th2 !spherical volume

!@@@ - booleans -

!! aovlap,all ! overlap areas
!! asba,A1,A2,SEPO,KEEP1,KEEP2 ! SEPO: seperate entities
!! asbw, !substract by wp
!! /pnum,area,1 $ aplot
!! vdele,all,,,1 !skwp 1:delete kp,l,a as well
!@@ -- material definitions --

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
!mplist,all
!! mpplot !plots mat. against temperature
!! tb,biso,Steel,1 ! bilinear isotropic plasticity
!! yield_stress=140
!! tangent_modulus=1400
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
!! Alu=2
!! mp,nuxy,Alu,0.3
!! mp,ex,Alu,70000
!! tb,biso,Alu,1
!! !! tbdata,,yield_stress,tangent_modulus !biso
!! /com, === Material %Alu% is Aluminium. ===
!! --- hyperelastic mooney rivlin mat ---
!! for 30 % compression 100 % tension strain

!! -- orthotropic linear material --
!! mp, alp{x,y,z}, Steel, val
!! mp, e{x,y,z}, Steel, val

!! --- Elastomers (hyperelastic) ---
!! Rubber = 3
!! tb,hyper,Rubber,,,MOONEY
!! Shore = 60
!! ShearModule = 0.086*1.045**Shore
!! tbdata,1,3*ShearModule/6.6
!! tbdata,2,.3*ShearModule/6.6
!! -- check whether to drop elem. midside nodes and use u-p formulation
!! keyopt,Rubber,6,1		 !(6)1: mixed u-p formulation
!! ! ogden for high strain applic. (700 % strain)
!! tb,hyper,Rubber,,,OGDEN

!! --- Magnetic materials ---
!! Air = 4
!! mp,murx,Air,1 ! murx permeability
!! Magnet = 5
!! Hc = 2.8e5 ! ferrit magnet coercive force in A/m
!! mp,mgxx,Magnet,Hc 
!! Pi = acos(-1)
!! Mu0 = .4*Pi*1e-6 ! field constant in Vs/(Am)
!! Br = .4 ! residual induction in Tesla
!! mp,murx,Magnet,Br/(Mu0*Hc)

!! /pnum,mat,1 $ eplot
!! ------------------------------
!@@ -- element definition --

ID=Steel
et,ID,solid186 !3d, 20 node
etlist !list defined elements
!! et,ID,solid185 !3d, 8 node
!! et,ID,plane183,,,0 !2d, 8 node (3)0:plane stress, 1:axissymmetric
!! et,ID,plane182 !2d, 4 node
!! keyopt,ID,3,1 !(3)=0:plane stress,1:axissym,2:plain strain.
!! keyopt,ID,1,0 !(1)=0:reduced integr.2:enhanced strain for bending
!! !!for most elements the radial direction is the x-axis
!! --- magnetics ---
!! et,ID,plane13 !2d, legacy coupled-field ->plane53
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,5,2 !(5)=2:nodal magnetic field printout
!! et,ID,infin110 !2d semi infinit electromagnetic elem.
!! !only 1 element layer, sized in the order of the problem domain
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,2,1 !(2)=0:4-node,1:8-n
!! --- assign attributes ---
!! aatt,MAT,REAL,TYPE ! associate prop. with selected areas

!! /pnum,type,1 $ eplot ! display materials
!! ------------------------------
!@@ -- meshing --

!! mat,Steel
!! mshkey,1 !1: mapped meshing,2: mapped if possible
!! mshape,0 !0: quads 1:tri (supported shapes)
esize,1 ! element edge length
!! lesize,all,,,3 ! SPACE neg: center to end division
!! ! vmesh,all
!! amesh,all
!! -- cyclic symmetric meshing --
!! cyclic ! check sectors in case of cyclic sym.
!! *status ! look for CYCLIC_XREF
!! cyclic,status
!! /cycexpand ! expand graphics rep.

!! /pnum,mat,1 $ eplot
!@@ -- boundary conditions --

/prep7

!kbc,1 ![0] (antype,static): ramped 1:stepped loading

!@@@ - displacements -

!nsel,s,loc,y,0
!    ,a,loc,y,1
!    ,r,loc,x,0
d,all,all
!dlist,all

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++!! (setq font-lock-maximum-decoration '((ansys-mode . 1)))
!(progn (unload-feature 'ansys-mode)(load-file "ansys-mode.el")(ansys-mode))
f
fi
fin
fini
finis 
finish
finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Copper= 3
False = 0$True =1
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans  '_otto'	 ! _vars: macro reserved words
*afun,rad
!! APDL get/parametricfunctions & old style (deprecated) Anys comments
var1=sinh(nx(.3 *5)) !old style Ansys comments!!!!!
var2 = tanh(cos(.3*5)) !not an old style Ansys comment
!! undocumented commands
/xml
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular
/com,hans holz ! this is really no comment
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Icoil = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands without arguments
/prep7 $ finish
/prep7 !nothing behind
/prep7 nothing behind
rect,X1,_X2,Y1,Y2 ! 2d rectangle
nsel,s,loc,y,0
    ,a,loc,y,1
d,all,all
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,10
*endif
!! implicit (colon) looping
lfillt,(1:2),(3:4),5
*dowhile,PAR
*cycle, bla _bla
*cyc
  *exit
*enddo
! goto branching
*go,:BRANCH
:BRANCH
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
vvv!! ====================
 
alsalsdkfjaölsdkfjaölskdjf 
nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------
!@@ -- cad import -- 

/aux15
ioptn,iges,nodefeat
ioptn,merge,yes
ioptn,solid,yes
ioptn,small,yes
ioptn,gtoler,defa
igesin,'test','iges'

/input,filename,anf ! for APDL based input
/facet,norm
!! ------------------------------
!@@ -- configurations --

! *afun,deg ! trig. functions accept angle arguments
*afun,rad
True = 1
False = 0

/title,
/plopts,wp,1 !display working plane
/triad,rbot !off, orig, ltop, ...
!/cwd,DIR !changes working directory
!! ------------------------------
!@@ -- geometry --

/prep7
rectng,X1,X2,Y1,Y2 ! 2d rectangle
!!arsym,y,all ! reflection of areas Xc = 0
Yc = 0
R1=4
R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder
!shpere,rad1,rad2,th1,th2 !spherical volume

!@@@ - booleans -

!! aovlap,all ! overlap areas
!! asba,A1,A2,SEPO,KEEP1,KEEP2 ! SEPO: seperate entities
!! asbw, !substract by wp
!! /pnum,area,1 $ aplot
!! vdele,all,,,1 !skwp 1:delete kp,l,a as well
!@@ -- material definitions --

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
!mplist,all
!! mpplot !plots mat. against temperature
!! tb,biso,Steel,1 ! bilinear isotropic plasticity
!! yield_stress=140
!! tangent_modulus=1400
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
!! Alu=2
!! mp,nuxy,Alu,0.3
!! mp,ex,Alu,70000
!! tb,biso,Alu,1
!! !! tbdata,,yield_stress,tangent_modulus !biso
!! /com, === Material %Alu% is Aluminium. ===
!! --- hyperelastic mooney rivlin mat ---
!! for 30 % compression 100 % tension strain

!! -- orthotropic linear material --
!! mp, alp{x,y,z}, Steel, val
!! mp, e{x,y,z}, Steel, val

!! --- Elastomers (hyperelastic) ---
!! Rubber = 3
!! tb,hyper,Rubber,,,MOONEY
!! Shore = 60
!! ShearModule = 0.086*1.045**Shore
!! tbdata,1,3*ShearModule/6.6
!! tbdata,2,.3*ShearModule/6.6
!! -- check whether to drop elem. midside nodes and use u-p formulation
!! keyopt,Rubber,6,1		 !(6)1: mixed u-p formulation
!! ! ogden for high strain applic. (700 % strain)
!! tb,hyper,Rubber,,,OGDEN

!! --- Magnetic materials ---
!! Air = 4
!! mp,murx,Air,1 ! murx permeability
!! Magnet = 5
!! Hc = 2.8e5 ! ferrit magnet coercive force in A/m
!! mp,mgxx,Magnet,Hc 
!! Pi = acos(-1)
!! Mu0 = .4*Pi*1e-6 ! field constant in Vs/(Am)
!! Br = .4 ! residual induction in Tesla
!! mp,murx,Magnet,Br/(Mu0*Hc)

!! /pnum,mat,1 $ eplot
!! ------------------------------
!@@ -- element definition --

ID=Steel
et,ID,solid186 !3d, 20 node
etlist !list defined elements
!! et,ID,solid185 !3d, 8 node
!! et,ID,plane183,,,0 !2d, 8 node (3)0:plane stress, 1:axissymmetric
!! et,ID,plane182 !2d, 4 node
!! keyopt,ID,3,1 !(3)=0:plane stress,1:axissym,2:plain strain.
!! keyopt,ID,1,0 !(1)=0:reduced integr.2:enhanced strain for bending
!! !!for most elements the radial direction is the x-axis
!! --- magnetics ---
!! et,ID,plane13 !2d, legacy coupled-field ->plane53
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,5,2 !(5)=2:nodal magnetic field printout
!! et,ID,infin110 !2d semi infinit electromagnetic elem.
!! !only 1 element layer, sized in the order of the problem domain
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,2,1 !(2)=0:4-node,1:8-n
!! --- assign attributes ---
!! aatt,MAT,REAL,TYPE ! associate prop. with selected areas

!! /pnum,type,1 $ eplot ! display materials
!! ------------------------------
!@@ -- meshing --

!! mat,Steel
!! mshkey,1 !1: mapped meshing,2: mapped if possible
!! mshape,0 !0: quads 1:tri (supported shapes)
esize,1 ! element edge length
!! lesize,all,,,3 ! SPACE neg: center to end division
!! ! vmesh,all
!! amesh,all
!! -- cyclic symmetric meshing --
!! cyclic ! check sectors in case of cyclic sym.
!! *status ! look for CYCLIC_XREF
!! cyclic,status
!! /cycexpand ! expand graphics rep.

!! /pnum,mat,1 $ eplot
!@@ -- boundary conditions --

/prep7

!kbc,1 ![0] (antype,static): ramped 1:stepped loading

!@@@ - displacements -

!nsel,s,loc,y,0
!    ,a,loc,y,1
!    ,r,loc,x,0
d,all,all
!dlist,all

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++!! (setq font-lock-maximum-decoration '((ansys-mode . 1)))
!(progn (unload-feature 'ansys-mode)(load-file "ansys-mode.el")(ansys-mode))
f
fi
fin
fini
finis 
finish
finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Copper= 3
False = 0$True =1
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans  '_otto'	 ! _vars: macro reserved words
*afun,rad
!! APDL get/parametricfunctions & old style (deprecated) Anys comments
var1=sinh(nx(.3 *5)) !old style Ansys comments!!!!!
var2 = tanh(cos(.3*5)) !not an old style Ansys comment
!! undocumented commands
/xml
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular
/com,hans holz ! this is really no comment
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Icoil = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands without arguments
/prep7 $ finish
/prep7 !nothing behind
/prep7 nothing behind
rect,X1,_X2,Y1,Y2 ! 2d rectangle
nsel,s,loc,y,0
    ,a,loc,y,1
d,all,all
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,10
*endif
!! implicit (colon) looping
lfillt,(1:2),(3:4),5
*dowhile,PAR
*cycle, bla _bla
*cyc
  *exit
*enddo
! goto branching
*go,:BRANCH
:BRANCH
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
vvv!! ====================
 
alsalsdkfjaölsdkfjaölskdjf 
nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------
!@@ -- cad import -- 

/aux15
ioptn,iges,nodefeat
ioptn,merge,yes
ioptn,solid,yes
ioptn,small,yes
ioptn,gtoler,defa
igesin,'test','iges'

/input,filename,anf ! for APDL based input
/facet,norm
!! ------------------------------
!@@ -- configurations --

! *afun,deg ! trig. functions accept angle arguments
*afun,rad
True = 1
False = 0

/title,
/plopts,wp,1 !display working plane
/triad,rbot !off, orig, ltop, ...
!/cwd,DIR !changes working directory
!! ------------------------------
!@@ -- geometry --

/prep7
rectng,X1,X2,Y1,Y2 ! 2d rectangle
!!arsym,y,all ! reflection of areas Xc = 0
Yc = 0
R1=4
R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder
!shpere,rad1,rad2,th1,th2 !spherical volume

!@@@ - booleans -

!! aovlap,all ! overlap areas
!! asba,A1,A2,SEPO,KEEP1,KEEP2 ! SEPO: seperate entities
!! asbw, !substract by wp
!! /pnum,area,1 $ aplot
!! vdele,all,,,1 !skwp 1:delete kp,l,a as well
!@@ -- material definitions --

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
!mplist,all
!! mpplot !plots mat. against temperature
!! tb,biso,Steel,1 ! bilinear isotropic plasticity
!! yield_stress=140
!! tangent_modulus=1400
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
!! Alu=2
!! mp,nuxy,Alu,0.3
!! mp,ex,Alu,70000
!! tb,biso,Alu,1
!! !! tbdata,,yield_stress,tangent_modulus !biso
!! /com, === Material %Alu% is Aluminium. ===
!! --- hyperelastic mooney rivlin mat ---
!! for 30 % compression 100 % tension strain

!! -- orthotropic linear material --
!! mp, alp{x,y,z}, Steel, val
!! mp, e{x,y,z}, Steel, val

!! --- Elastomers (hyperelastic) ---
!! Rubber = 3
!! tb,hyper,Rubber,,,MOONEY
!! Shore = 60
!! ShearModule = 0.086*1.045**Shore
!! tbdata,1,3*ShearModule/6.6
!! tbdata,2,.3*ShearModule/6.6
!! -- check whether to drop elem. midside nodes and use u-p formulation
!! keyopt,Rubber,6,1		 !(6)1: mixed u-p formulation
!! ! ogden for high strain applic. (700 % strain)
!! tb,hyper,Rubber,,,OGDEN

!! --- Magnetic materials ---
!! Air = 4
!! mp,murx,Air,1 ! murx permeability
!! Magnet = 5
!! Hc = 2.8e5 ! ferrit magnet coercive force in A/m
!! mp,mgxx,Magnet,Hc 
!! Pi = acos(-1)
!! Mu0 = .4*Pi*1e-6 ! field constant in Vs/(Am)
!! Br = .4 ! residual induction in Tesla
!! mp,murx,Magnet,Br/(Mu0*Hc)

!! /pnum,mat,1 $ eplot
!! ------------------------------
!@@ -- element definition --

ID=Steel
et,ID,solid186 !3d, 20 node
etlist !list defined elements
!! et,ID,solid185 !3d, 8 node
!! et,ID,plane183,,,0 !2d, 8 node (3)0:plane stress, 1:axissymmetric
!! et,ID,plane182 !2d, 4 node
!! keyopt,ID,3,1 !(3)=0:plane stress,1:axissym,2:plain strain.
!! keyopt,ID,1,0 !(1)=0:reduced integr.2:enhanced strain for bending
!! !!for most elements the radial direction is the x-axis
!! --- magnetics ---
!! et,ID,plane13 !2d, legacy coupled-field ->plane53
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,5,2 !(5)=2:nodal magnetic field printout
!! et,ID,infin110 !2d semi infinit electromagnetic elem.
!! !only 1 element layer, sized in the order of the problem domain
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,2,1 !(2)=0:4-node,1:8-n
!! --- assign attributes ---
!! aatt,MAT,REAL,TYPE ! associate prop. with selected areas

!! /pnum,type,1 $ eplot ! display materials
!! ------------------------------
!@@ -- meshing --

!! mat,Steel
!! mshkey,1 !1: mapped meshing,2: mapped if possible
!! mshape,0 !0: quads 1:tri (supported shapes)
esize,1 ! element edge length
!! lesize,all,,,3 ! SPACE neg: center to end division
!! ! vmesh,all
!! amesh,all
!! -- cyclic symmetric meshing --
!! cyclic ! check sectors in case of cyclic sym.
!! *status ! look for CYCLIC_XREF
!! cyclic,status
!! /cycexpand ! expand graphics rep.

!! /pnum,mat,1 $ eplot
!@@ -- boundary conditions --

/prep7

!kbc,1 ![0] (antype,static): ramped 1:stepped loading

!@@@ - displacements -

!nsel,s,loc,y,0
!    ,a,loc,y,1
!    ,r,loc,x,0
d,all,all
!dlist,all

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++!! (setq font-lock-maximum-decoration '((ansys-mode . 1)))
!(progn (unload-feature 'ansys-mode)(load-file "ansys-mode.el")(ansys-mode))
f
fi
fin
fini
finis 
finish
finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Copper= 3
False = 0$True =1
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans  '_otto'	 ! _vars: macro reserved words
*afun,rad
!! APDL get/parametricfunctions & old style (deprecated) Anys comments
var1=sinh(nx(.3 *5)) !old style Ansys comments!!!!!
var2 = tanh(cos(.3*5)) !not an old style Ansys comment
!! undocumented commands
/xml
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular
/com,hans holz ! this is really no comment
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Icoil = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands without arguments
/prep7 $ finish
/prep7 !nothing behind
/prep7 nothing behind
rect,X1,_X2,Y1,Y2 ! 2d rectangle
nsel,s,loc,y,0
    ,a,loc,y,1
d,all,all
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,10
*endif
!! implicit (colon) looping
lfillt,(1:2),(3:4),5
*dowhile,PAR
*cycle, bla _bla
*cyc
  *exit
*enddo
! goto branching
*go,:BRANCH
:BRANCH
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
vvv!! ====================
 
alsalsdkfjaölsdkfjaölskdjf 
nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------
!@@ -- cad import -- 

/aux15
ioptn,iges,nodefeat
ioptn,merge,yes
ioptn,solid,yes
ioptn,small,yes
ioptn,gtoler,defa
igesin,'test','iges'

/input,filename,anf ! for APDL based input
/facet,norm
!! ------------------------------
!@@ -- configurations --

! *afun,deg ! trig. functions accept angle arguments
*afun,rad
True = 1
False = 0

/title,
/plopts,wp,1 !display working plane
/triad,rbot !off, orig, ltop, ...
!/cwd,DIR !changes working directory
!! ------------------------------
!@@ -- geometry --

/prep7
rectng,X1,X2,Y1,Y2 ! 2d rectangle
!!arsym,y,all ! reflection of areas Xc = 0
Yc = 0
R1=4
R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder
!shpere,rad1,rad2,th1,th2 !spherical volume

!@@@ - booleans -

!! aovlap,all ! overlap areas
!! asba,A1,A2,SEPO,KEEP1,KEEP2 ! SEPO: seperate entities
!! asbw, !substract by wp
!! /pnum,area,1 $ aplot
!! vdele,all,,,1 !skwp 1:delete kp,l,a as well
!@@ -- material definitions --

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
!mplist,all
!! mpplot !plots mat. against temperature
!! tb,biso,Steel,1 ! bilinear isotropic plasticity
!! yield_stress=140
!! tangent_modulus=1400
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
!! Alu=2
!! mp,nuxy,Alu,0.3
!! mp,ex,Alu,70000
!! tb,biso,Alu,1
!! !! tbdata,,yield_stress,tangent_modulus !biso
!! /com, === Material %Alu% is Aluminium. ===
!! --- hyperelastic mooney rivlin mat ---
!! for 30 % compression 100 % tension strain

!! -- orthotropic linear material --
!! mp, alp{x,y,z}, Steel, val
!! mp, e{x,y,z}, Steel, val

!! --- Elastomers (hyperelastic) ---
!! Rubber = 3
!! tb,hyper,Rubber,,,MOONEY
!! Shore = 60
!! ShearModule = 0.086*1.045**Shore
!! tbdata,1,3*ShearModule/6.6
!! tbdata,2,.3*ShearModule/6.6
!! -- check whether to drop elem. midside nodes and use u-p formulation
!! keyopt,Rubber,6,1		 !(6)1: mixed u-p formulation
!! ! ogden for high strain applic. (700 % strain)
!! tb,hyper,Rubber,,,OGDEN

!! --- Magnetic materials ---
!! Air = 4
!! mp,murx,Air,1 ! murx permeability
!! Magnet = 5
!! Hc = 2.8e5 ! ferrit magnet coercive force in A/m
!! mp,mgxx,Magnet,Hc 
!! Pi = acos(-1)
!! Mu0 = .4*Pi*1e-6 ! field constant in Vs/(Am)
!! Br = .4 ! residual induction in Tesla
!! mp,murx,Magnet,Br/(Mu0*Hc)

!! /pnum,mat,1 $ eplot
!! ------------------------------
!@@ -- element definition --

ID=Steel
et,ID,solid186 !3d, 20 node
etlist !list defined elements
!! et,ID,solid185 !3d, 8 node
!! et,ID,plane183,,,0 !2d, 8 node (3)0:plane stress, 1:axissymmetric
!! et,ID,plane182 !2d, 4 node
!! keyopt,ID,3,1 !(3)=0:plane stress,1:axissym,2:plain strain.
!! keyopt,ID,1,0 !(1)=0:reduced integr.2:enhanced strain for bending
!! !!for most elements the radial direction is the x-axis
!! --- magnetics ---
!! et,ID,plane13 !2d, legacy coupled-field ->plane53
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,5,2 !(5)=2:nodal magnetic field printout
!! et,ID,infin110 !2d semi infinit electromagnetic elem.
!! !only 1 element layer, sized in the order of the problem domain
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,2,1 !(2)=0:4-node,1:8-n
!! --- assign attributes ---
!! aatt,MAT,REAL,TYPE ! associate prop. with selected areas

!! /pnum,type,1 $ eplot ! display materials
!! ------------------------------
!@@ -- meshing --

!! mat,Steel
!! mshkey,1 !1: mapped meshing,2: mapped if possible
!! mshape,0 !0: quads 1:tri (supported shapes)
esize,1 ! element edge length
!! lesize,all,,,3 ! SPACE neg: center to end division
!! ! vmesh,all
!! amesh,all
!! -- cyclic symmetric meshing --
!! cyclic ! check sectors in case of cyclic sym.
!! *status ! look for CYCLIC_XREF
!! cyclic,status
!! /cycexpand ! expand graphics rep.

!! /pnum,mat,1 $ eplot
!@@ -- boundary conditions --

/prep7

!kbc,1 ![0] (antype,static): ramped 1:stepped loading

!@@@ - displacements -

!nsel,s,loc,y,0
!    ,a,loc,y,1
!    ,r,loc,x,0
d,all,all
!dlist,all

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++!! (setq font-lock-maximum-decoration '((ansys-mode . 1)))
!(progn (unload-feature 'ansys-mode)(load-file "ansys-mode.el")(ansys-mode))
f
fi
fin
fini
finis 
finish
finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Copper= 3
False = 0$True =1
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans  '_otto'	 ! _vars: macro reserved words
*afun,rad
!! APDL get/parametricfunctions & old style (deprecated) Anys comments
var1=sinh(nx(.3 *5)) !old style Ansys comments!!!!!
var2 = tanh(cos(.3*5)) !not an old style Ansys comment
!! undocumented commands
/xml
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular
/com,hans holz ! this is really no comment
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Icoil = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands without arguments
/prep7 $ finish
/prep7 !nothing behind
/prep7 nothing behind
rect,X1,_X2,Y1,Y2 ! 2d rectangle
nsel,s,loc,y,0
    ,a,loc,y,1
d,all,all
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,10
*endif
!! implicit (colon) looping
lfillt,(1:2),(3:4),5
*dowhile,PAR
*cycle, bla _bla
*cyc
  *exit
*enddo
! goto branching
*go,:BRANCH
:BRANCH
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
vvv!! ====================
 
alsalsdkfjaölsdkfjaölskdjf 
nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------
!@@ -- cad import -- 

/aux15
ioptn,iges,nodefeat
ioptn,merge,yes
ioptn,solid,yes
ioptn,small,yes
ioptn,gtoler,defa
igesin,'test','iges'

/input,filename,anf ! for APDL based input
/facet,norm
!! ------------------------------
!@@ -- configurations --

! *afun,deg ! trig. functions accept angle arguments
*afun,rad
True = 1
False = 0

/title,
/plopts,wp,1 !display working plane
/triad,rbot !off, orig, ltop, ...
!/cwd,DIR !changes working directory
!! ------------------------------
!@@ -- geometry --

/prep7
rectng,X1,X2,Y1,Y2 ! 2d rectangle
!!arsym,y,all ! reflection of areas Xc = 0
Yc = 0
R1=4
R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder
!shpere,rad1,rad2,th1,th2 !spherical volume

!@@@ - booleans -

!! aovlap,all ! overlap areas
!! asba,A1,A2,SEPO,KEEP1,KEEP2 ! SEPO: seperate entities
!! asbw, !substract by wp
!! /pnum,area,1 $ aplot
!! vdele,all,,,1 !skwp 1:delete kp,l,a as well
!@@ -- material definitions --

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
!mplist,all
!! mpplot !plots mat. against temperature
!! tb,biso,Steel,1 ! bilinear isotropic plasticity
!! yield_stress=140
!! tangent_modulus=1400
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
!! Alu=2
!! mp,nuxy,Alu,0.3
!! mp,ex,Alu,70000
!! tb,biso,Alu,1
!! !! tbdata,,yield_stress,tangent_modulus !biso
!! /com, === Material %Alu% is Aluminium. ===
!! --- hyperelastic mooney rivlin mat ---
!! for 30 % compression 100 % tension strain

!! -- orthotropic linear material --
!! mp, alp{x,y,z}, Steel, val
!! mp, e{x,y,z}, Steel, val

!! --- Elastomers (hyperelastic) ---
!! Rubber = 3
!! tb,hyper,Rubber,,,MOONEY
!! Shore = 60
!! ShearModule = 0.086*1.045**Shore
!! tbdata,1,3*ShearModule/6.6
!! tbdata,2,.3*ShearModule/6.6
!! -- check whether to drop elem. midside nodes and use u-p formulation
!! keyopt,Rubber,6,1		 !(6)1: mixed u-p formulation
!! ! ogden for high strain applic. (700 % strain)
!! tb,hyper,Rubber,,,OGDEN

!! --- Magnetic materials ---
!! Air = 4
!! mp,murx,Air,1 ! murx permeability
!! Magnet = 5
!! Hc = 2.8e5 ! ferrit magnet coercive force in A/m
!! mp,mgxx,Magnet,Hc 
!! Pi = acos(-1)
!! Mu0 = .4*Pi*1e-6 ! field constant in Vs/(Am)
!! Br = .4 ! residual induction in Tesla
!! mp,murx,Magnet,Br/(Mu0*Hc)

!! /pnum,mat,1 $ eplot
!! ------------------------------
!@@ -- element definition --

ID=Steel
et,ID,solid186 !3d, 20 node
etlist !list defined elements
!! et,ID,solid185 !3d, 8 node
!! et,ID,plane183,,,0 !2d, 8 node (3)0:plane stress, 1:axissymmetric
!! et,ID,plane182 !2d, 4 node
!! keyopt,ID,3,1 !(3)=0:plane stress,1:axissym,2:plain strain.
!! keyopt,ID,1,0 !(1)=0:reduced integr.2:enhanced strain for bending
!! !!for most elements the radial direction is the x-axis
!! --- magnetics ---
!! et,ID,plane13 !2d, legacy coupled-field ->plane53
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,5,2 !(5)=2:nodal magnetic field printout
!! et,ID,infin110 !2d semi infinit electromagnetic elem.
!! !only 1 element layer, sized in the order of the problem domain
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,2,1 !(2)=0:4-node,1:8-n
!! --- assign attributes ---
!! aatt,MAT,REAL,TYPE ! associate prop. with selected areas

!! /pnum,type,1 $ eplot ! display materials
!! ------------------------------
!@@ -- meshing --

!! mat,Steel
!! mshkey,1 !1: mapped meshing,2: mapped if possible
!! mshape,0 !0: quads 1:tri (supported shapes)
esize,1 ! element edge length
!! lesize,all,,,3 ! SPACE neg: center to end division
!! ! vmesh,all
!! amesh,all
!! -- cyclic symmetric meshing --
!! cyclic ! check sectors in case of cyclic sym.
!! *status ! look for CYCLIC_XREF
!! cyclic,status
!! /cycexpand ! expand graphics rep.

!! /pnum,mat,1 $ eplot
!@@ -- boundary conditions --

/prep7

!kbc,1 ![0] (antype,static): ramped 1:stepped loading

!@@@ - displacements -

!nsel,s,loc,y,0
!    ,a,loc,y,1
!    ,r,loc,x,0
d,all,all
!dlist,all

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++!! (setq font-lock-maximum-decoration '((ansys-mode . 1)))
!(progn (unload-feature 'ansys-mode)(load-file "ansys-mode.el")(ansys-mode))
f
fi
fin
fini
finis 
finish
finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Copper= 3
False = 0$True =1
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans  '_otto'	 ! _vars: macro reserved words
*afun,rad
!! APDL get/parametricfunctions & old style (deprecated) Anys comments
var1=sinh(nx(.3 *5)) !old style Ansys comments!!!!!
var2 = tanh(cos(.3*5)) !not an old style Ansys comment
!! undocumented commands
/xml
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular
/com,hans holz ! this is really no comment
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Icoil = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands without arguments
/prep7 $ finish
/prep7 !nothing behind
/prep7 nothing behind
rect,X1,_X2,Y1,Y2 ! 2d rectangle
nsel,s,loc,y,0
    ,a,loc,y,1
d,all,all
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,10
*endif
!! implicit (colon) looping
lfillt,(1:2),(3:4),5
*dowhile,PAR
*cycle, bla _bla
*cyc
  *exit
*enddo
! goto branching
*go,:BRANCH
:BRANCH
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
vvv!! ====================
 
alsalsdkfjaölsdkfjaölskdjf 
nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------
!@@ -- cad import -- 

/aux15
ioptn,iges,nodefeat
ioptn,merge,yes
ioptn,solid,yes
ioptn,small,yes
ioptn,gtoler,defa
igesin,'test','iges'

/input,filename,anf ! for APDL based input
/facet,norm
!! ------------------------------
!@@ -- configurations --

! *afun,deg ! trig. functions accept angle arguments
*afun,rad
True = 1
False = 0

/title,
/plopts,wp,1 !display working plane
/triad,rbot !off, orig, ltop, ...
!/cwd,DIR !changes working directory
!! ------------------------------
!@@ -- geometry --

/prep7
rectng,X1,X2,Y1,Y2 ! 2d rectangle
!!arsym,y,all ! reflection of areas Xc = 0
Yc = 0
R1=4
R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder
!shpere,rad1,rad2,th1,th2 !spherical volume

!@@@ - booleans -

!! aovlap,all ! overlap areas
!! asba,A1,A2,SEPO,KEEP1,KEEP2 ! SEPO: seperate entities
!! asbw, !substract by wp
!! /pnum,area,1 $ aplot
!! vdele,all,,,1 !skwp 1:delete kp,l,a as well
!@@ -- material definitions --

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
!mplist,all
!! mpplot !plots mat. against temperature
!! tb,biso,Steel,1 ! bilinear isotropic plasticity
!! yield_stress=140
!! tangent_modulus=1400
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
!! Alu=2
!! mp,nuxy,Alu,0.3
!! mp,ex,Alu,70000
!! tb,biso,Alu,1
!! !! tbdata,,yield_stress,tangent_modulus !biso
!! /com, === Material %Alu% is Aluminium. ===
!! --- hyperelastic mooney rivlin mat ---
!! for 30 % compression 100 % tension strain

!! -- orthotropic linear material --
!! mp, alp{x,y,z}, Steel, val
!! mp, e{x,y,z}, Steel, val

!! --- Elastomers (hyperelastic) ---
!! Rubber = 3
!! tb,hyper,Rubber,,,MOONEY
!! Shore = 60
!! ShearModule = 0.086*1.045**Shore
!! tbdata,1,3*ShearModule/6.6
!! tbdata,2,.3*ShearModule/6.6
!! -- check whether to drop elem. midside nodes and use u-p formulation
!! keyopt,Rubber,6,1		 !(6)1: mixed u-p formulation
!! ! ogden for high strain applic. (700 % strain)
!! tb,hyper,Rubber,,,OGDEN

!! --- Magnetic materials ---
!! Air = 4
!! mp,murx,Air,1 ! murx permeability
!! Magnet = 5
!! Hc = 2.8e5 ! ferrit magnet coercive force in A/m
!! mp,mgxx,Magnet,Hc 
!! Pi = acos(-1)
!! Mu0 = .4*Pi*1e-6 ! field constant in Vs/(Am)
!! Br = .4 ! residual induction in Tesla
!! mp,murx,Magnet,Br/(Mu0*Hc)

!! /pnum,mat,1 $ eplot
!! ------------------------------
!@@ -- element definition --

ID=Steel
et,ID,solid186 !3d, 20 node
etlist !list defined elements
!! et,ID,solid185 !3d, 8 node
!! et,ID,plane183,,,0 !2d, 8 node (3)0:plane stress, 1:axissymmetric
!! et,ID,plane182 !2d, 4 node
!! keyopt,ID,3,1 !(3)=0:plane stress,1:axissym,2:plain strain.
!! keyopt,ID,1,0 !(1)=0:reduced integr.2:enhanced strain for bending
!! !!for most elements the radial direction is the x-axis
!! --- magnetics ---
!! et,ID,plane13 !2d, legacy coupled-field ->plane53
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,5,2 !(5)=2:nodal magnetic field printout
!! et,ID,infin110 !2d semi infinit electromagnetic elem.
!! !only 1 element layer, sized in the order of the problem domain
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,2,1 !(2)=0:4-node,1:8-n
!! --- assign attributes ---
!! aatt,MAT,REAL,TYPE ! associate prop. with selected areas

!! /pnum,type,1 $ eplot ! display materials
!! ------------------------------
!@@ -- meshing --

!! mat,Steel
!! mshkey,1 !1: mapped meshing,2: mapped if possible
!! mshape,0 !0: quads 1:tri (supported shapes)
esize,1 ! element edge length
!! lesize,all,,,3 ! SPACE neg: center to end division
!! ! vmesh,all
!! amesh,all
!! -- cyclic symmetric meshing --
!! cyclic ! check sectors in case of cyclic sym.
!! *status ! look for CYCLIC_XREF
!! cyclic,status
!! /cycexpand ! expand graphics rep.

!! /pnum,mat,1 $ eplot
!@@ -- boundary conditions --

/prep7

!kbc,1 ![0] (antype,static): ramped 1:stepped loading

!@@@ - displacements -

!nsel,s,loc,y,0
!    ,a,loc,y,1
!    ,r,loc,x,0
d,all,all
!dlist,all

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++!! (setq font-lock-maximum-decoration '((ansys-mode . 1)))
!(progn (unload-feature 'ansys-mode)(load-file "ansys-mode.el")(ansys-mode))
f
fi
fin
fini
finis 
finish
finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Copper= 3
False = 0$True =1
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans  '_otto'	 ! _vars: macro reserved words
*afun,rad
!! APDL get/parametricfunctions & old style (deprecated) Anys comments
var1=sinh(nx(.3 *5)) !old style Ansys comments!!!!!
var2 = tanh(cos(.3*5)) !not an old style Ansys comment
!! undocumented commands
/xml
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular
/com,hans holz ! this is really no comment
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Icoil = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands without arguments
/prep7 $ finish
/prep7 !nothing behind
/prep7 nothing behind
rect,X1,_X2,Y1,Y2 ! 2d rectangle
nsel,s,loc,y,0
    ,a,loc,y,1
d,all,all
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,10
*endif
!! implicit (colon) looping
lfillt,(1:2),(3:4),5
*dowhile,PAR
*cycle, bla _bla
*cyc
  *exit
*enddo
! goto branching
*go,:BRANCH
:BRANCH
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
vvv!! ====================
 
alsalsdkfjaölsdkfjaölskdjf 
nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------
!@@ -- cad import -- 

/aux15
ioptn,iges,nodefeat
ioptn,merge,yes
ioptn,solid,yes
ioptn,small,yes
ioptn,gtoler,defa
igesin,'test','iges'

/input,filename,anf ! for APDL based input
/facet,norm
!! ------------------------------
!@@ -- configurations --

! *afun,deg ! trig. functions accept angle arguments
*afun,rad
True = 1
False = 0

/title,
/plopts,wp,1 !display working plane
/triad,rbot !off, orig, ltop, ...
!/cwd,DIR !changes working directory
!! ------------------------------
!@@ -- geometry --

/prep7
rectng,X1,X2,Y1,Y2 ! 2d rectangle
!!arsym,y,all ! reflection of areas Xc = 0
Yc = 0
R1=4
R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder
!shpere,rad1,rad2,th1,th2 !spherical volume

!@@@ - booleans -

!! aovlap,all ! overlap areas
!! asba,A1,A2,SEPO,KEEP1,KEEP2 ! SEPO: seperate entities
!! asbw, !substract by wp
!! /pnum,area,1 $ aplot
!! vdele,all,,,1 !skwp 1:delete kp,l,a as well
!@@ -- material definitions --

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
!mplist,all
!! mpplot !plots mat. against temperature
!! tb,biso,Steel,1 ! bilinear isotropic plasticity
!! yield_stress=140
!! tangent_modulus=1400
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
!! Alu=2
!! mp,nuxy,Alu,0.3
!! mp,ex,Alu,70000
!! tb,biso,Alu,1
!! !! tbdata,,yield_stress,tangent_modulus !biso
!! /com, === Material %Alu% is Aluminium. ===
!! --- hyperelastic mooney rivlin mat ---
!! for 30 % compression 100 % tension strain

!! -- orthotropic linear material --
!! mp, alp{x,y,z}, Steel, val
!! mp, e{x,y,z}, Steel, val

!! --- Elastomers (hyperelastic) ---
!! Rubber = 3
!! tb,hyper,Rubber,,,MOONEY
!! Shore = 60
!! ShearModule = 0.086*1.045**Shore
!! tbdata,1,3*ShearModule/6.6
!! tbdata,2,.3*ShearModule/6.6
!! -- check whether to drop elem. midside nodes and use u-p formulation
!! keyopt,Rubber,6,1		 !(6)1: mixed u-p formulation
!! ! ogden for high strain applic. (700 % strain)
!! tb,hyper,Rubber,,,OGDEN

!! --- Magnetic materials ---
!! Air = 4
!! mp,murx,Air,1 ! murx permeability
!! Magnet = 5
!! Hc = 2.8e5 ! ferrit magnet coercive force in A/m
!! mp,mgxx,Magnet,Hc 
!! Pi = acos(-1)
!! Mu0 = .4*Pi*1e-6 ! field constant in Vs/(Am)
!! Br = .4 ! residual induction in Tesla
!! mp,murx,Magnet,Br/(Mu0*Hc)

!! /pnum,mat,1 $ eplot
!! ------------------------------
!@@ -- element definition --

ID=Steel
et,ID,solid186 !3d, 20 node
etlist !list defined elements
!! et,ID,solid185 !3d, 8 node
!! et,ID,plane183,,,0 !2d, 8 node (3)0:plane stress, 1:axissymmetric
!! et,ID,plane182 !2d, 4 node
!! keyopt,ID,3,1 !(3)=0:plane stress,1:axissym,2:plain strain.
!! keyopt,ID,1,0 !(1)=0:reduced integr.2:enhanced strain for bending
!! !!for most elements the radial direction is the x-axis
!! --- magnetics ---
!! et,ID,plane13 !2d, legacy coupled-field ->plane53
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,5,2 !(5)=2:nodal magnetic field printout
!! et,ID,infin110 !2d semi infinit electromagnetic elem.
!! !only 1 element layer, sized in the order of the problem domain
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,2,1 !(2)=0:4-node,1:8-n
!! --- assign attributes ---
!! aatt,MAT,REAL,TYPE ! associate prop. with selected areas

!! /pnum,type,1 $ eplot ! display materials
!! ------------------------------
!@@ -- meshing --

!! mat,Steel
!! mshkey,1 !1: mapped meshing,2: mapped if possible
!! mshape,0 !0: quads 1:tri (supported shapes)
esize,1 ! element edge length
!! lesize,all,,,3 ! SPACE neg: center to end division
!! ! vmesh,all
!! amesh,all
!! -- cyclic symmetric meshing --
!! cyclic ! check sectors in case of cyclic sym.
!! *status ! look for CYCLIC_XREF
!! cyclic,status
!! /cycexpand ! expand graphics rep.

!! /pnum,mat,1 $ eplot
!@@ -- boundary conditions --

/prep7

!kbc,1 ![0] (antype,static): ramped 1:stepped loading

!@@@ - displacements -

!nsel,s,loc,y,0
!    ,a,loc,y,1
!    ,r,loc,x,0
d,all,all
!dlist,all

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++!! (setq font-lock-maximum-decoration '((ansys-mode . 1)))
!(progn (unload-feature 'ansys-mode)(load-file "ansys-mode.el")(ansys-mode))
f
fi
fin
fini
finis 
finish
finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Copper= 3
False = 0$True =1
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans  '_otto'	 ! _vars: macro reserved words
*afun,rad
!! APDL get/parametricfunctions & old style (deprecated) Anys comments
var1=sinh(nx(.3 *5)) !old style Ansys comments!!!!!
var2 = tanh(cos(.3*5)) !not an old style Ansys comment
!! undocumented commands
/xml
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular
/com,hans holz ! this is really no comment
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Icoil = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands without arguments
/prep7 $ finish
/prep7 !nothing behind
/prep7 nothing behind
rect,X1,_X2,Y1,Y2 ! 2d rectangle
nsel,s,loc,y,0
    ,a,loc,y,1
d,all,all
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,10
*endif
!! implicit (colon) looping
lfillt,(1:2),(3:4),5
*dowhile,PAR
*cycle, bla _bla
*cyc
  *exit
*enddo
! goto branching
*go,:BRANCH
:BRANCH
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
vvv!! ====================
 
alsalsdkfjaölsdkfjaölskdjf 
nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------
!@@ -- cad import -- 

/aux15
ioptn,iges,nodefeat
ioptn,merge,yes
ioptn,solid,yes
ioptn,small,yes
ioptn,gtoler,defa
igesin,'test','iges'

/input,filename,anf ! for APDL based input
/facet,norm
!! ------------------------------
!@@ -- configurations --

! *afun,deg ! trig. functions accept angle arguments
*afun,rad
True = 1
False = 0

/title,
/plopts,wp,1 !display working plane
/triad,rbot !off, orig, ltop, ...
!/cwd,DIR !changes working directory
!! ------------------------------
!@@ -- geometry --

/prep7
rectng,X1,X2,Y1,Y2 ! 2d rectangle
!!arsym,y,all ! reflection of areas Xc = 0
Yc = 0
R1=4
R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder
!shpere,rad1,rad2,th1,th2 !spherical volume

!@@@ - booleans -

!! aovlap,all ! overlap areas
!! asba,A1,A2,SEPO,KEEP1,KEEP2 ! SEPO: seperate entities
!! asbw, !substract by wp
!! /pnum,area,1 $ aplot
!! vdele,all,,,1 !skwp 1:delete kp,l,a as well
!@@ -- material definitions --

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
!mplist,all
!! mpplot !plots mat. against temperature
!! tb,biso,Steel,1 ! bilinear isotropic plasticity
!! yield_stress=140
!! tangent_modulus=1400
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
!! Alu=2
!! mp,nuxy,Alu,0.3
!! mp,ex,Alu,70000
!! tb,biso,Alu,1
!! !! tbdata,,yield_stress,tangent_modulus !biso
!! /com, === Material %Alu% is Aluminium. ===
!! --- hyperelastic mooney rivlin mat ---
!! for 30 % compression 100 % tension strain

!! -- orthotropic linear material --
!! mp, alp{x,y,z}, Steel, val
!! mp, e{x,y,z}, Steel, val

!! --- Elastomers (hyperelastic) ---
!! Rubber = 3
!! tb,hyper,Rubber,,,MOONEY
!! Shore = 60
!! ShearModule = 0.086*1.045**Shore
!! tbdata,1,3*ShearModule/6.6
!! tbdata,2,.3*ShearModule/6.6
!! -- check whether to drop elem. midside nodes and use u-p formulation
!! keyopt,Rubber,6,1		 !(6)1: mixed u-p formulation
!! ! ogden for high strain applic. (700 % strain)
!! tb,hyper,Rubber,,,OGDEN

!! --- Magnetic materials ---
!! Air = 4
!! mp,murx,Air,1 ! murx permeability
!! Magnet = 5
!! Hc = 2.8e5 ! ferrit magnet coercive force in A/m
!! mp,mgxx,Magnet,Hc 
!! Pi = acos(-1)
!! Mu0 = .4*Pi*1e-6 ! field constant in Vs/(Am)
!! Br = .4 ! residual induction in Tesla
!! mp,murx,Magnet,Br/(Mu0*Hc)

!! /pnum,mat,1 $ eplot
!! ------------------------------
!@@ -- element definition --

ID=Steel
et,ID,solid186 !3d, 20 node
etlist !list defined elements
!! et,ID,solid185 !3d, 8 node
!! et,ID,plane183,,,0 !2d, 8 node (3)0:plane stress, 1:axissymmetric
!! et,ID,plane182 !2d, 4 node
!! keyopt,ID,3,1 !(3)=0:plane stress,1:axissym,2:plain strain.
!! keyopt,ID,1,0 !(1)=0:reduced integr.2:enhanced strain for bending
!! !!for most elements the radial direction is the x-axis
!! --- magnetics ---
!! et,ID,plane13 !2d, legacy coupled-field ->plane53
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,5,2 !(5)=2:nodal magnetic field printout
!! et,ID,infin110 !2d semi infinit electromagnetic elem.
!! !only 1 element layer, sized in the order of the problem domain
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,2,1 !(2)=0:4-node,1:8-n
!! --- assign attributes ---
!! aatt,MAT,REAL,TYPE ! associate prop. with selected areas

!! /pnum,type,1 $ eplot ! display materials
!! ------------------------------
!@@ -- meshing --

!! mat,Steel
!! mshkey,1 !1: mapped meshing,2: mapped if possible
!! mshape,0 !0: quads 1:tri (supported shapes)
esize,1 ! element edge length
!! lesize,all,,,3 ! SPACE neg: center to end division
!! ! vmesh,all
!! amesh,all
!! -- cyclic symmetric meshing --
!! cyclic ! check sectors in case of cyclic sym.
!! *status ! look for CYCLIC_XREF
!! cyclic,status
!! /cycexpand ! expand graphics rep.

!! /pnum,mat,1 $ eplot
!@@ -- boundary conditions --

/prep7

!kbc,1 ![0] (antype,static): ramped 1:stepped loading

!@@@ - displacements -

!nsel,s,loc,y,0
!    ,a,loc,y,1
!    ,r,loc,x,0
d,all,all
!dlist,all

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++!! (setq font-lock-maximum-decoration '((ansys-mode . 1)))
!(progn (unload-feature 'ansys-mode)(load-file "ansys-mode.el")(ansys-mode))
f
fi
fin
fini
finis 
finish
finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Copper= 3
False = 0$True =1
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans  '_otto'	 ! _vars: macro reserved words
*afun,rad
!! APDL get/parametricfunctions & old style (deprecated) Anys comments
var1=sinh(nx(.3 *5)) !old style Ansys comments!!!!!
var2 = tanh(cos(.3*5)) !not an old style Ansys comment
!! undocumented commands
/xml
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular
/com,hans holz ! this is really no comment
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Icoil = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands without arguments
/prep7 $ finish
/prep7 !nothing behind
/prep7 nothing behind
rect,X1,_X2,Y1,Y2 ! 2d rectangle
nsel,s,loc,y,0
    ,a,loc,y,1
d,all,all
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,10
*endif
!! implicit (colon) looping
lfillt,(1:2),(3:4),5
*dowhile,PAR
*cycle, bla _bla
*cyc
  *exit
*enddo
! goto branching
*go,:BRANCH
:BRANCH
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
vvv!! ====================
 
alsalsdkfjaölsdkfjaölskdjf 
nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------
!@@ -- cad import -- 

/aux15
ioptn,iges,nodefeat
ioptn,merge,yes
ioptn,solid,yes
ioptn,small,yes
ioptn,gtoler,defa
igesin,'test','iges'

/input,filename,anf ! for APDL based input
/facet,norm
!! ------------------------------
!@@ -- configurations --

! *afun,deg ! trig. functions accept angle arguments
*afun,rad
True = 1
False = 0

/title,
/plopts,wp,1 !display working plane
/triad,rbot !off, orig, ltop, ...
!/cwd,DIR !changes working directory
!! ------------------------------
!@@ -- geometry --

/prep7
rectng,X1,X2,Y1,Y2 ! 2d rectangle
!!arsym,y,all ! reflection of areas Xc = 0
Yc = 0
R1=4
R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder
!shpere,rad1,rad2,th1,th2 !spherical volume

!@@@ - booleans -

!! aovlap,all ! overlap areas
!! asba,A1,A2,SEPO,KEEP1,KEEP2 ! SEPO: seperate entities
!! asbw, !substract by wp
!! /pnum,area,1 $ aplot
!! vdele,all,,,1 !skwp 1:delete kp,l,a as well
!@@ -- material definitions --

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
!mplist,all
!! mpplot !plots mat. against temperature
!! tb,biso,Steel,1 ! bilinear isotropic plasticity
!! yield_stress=140
!! tangent_modulus=1400
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
!! Alu=2
!! mp,nuxy,Alu,0.3
!! mp,ex,Alu,70000
!! tb,biso,Alu,1
!! !! tbdata,,yield_stress,tangent_modulus !biso
!! /com, === Material %Alu% is Aluminium. ===
!! --- hyperelastic mooney rivlin mat ---
!! for 30 % compression 100 % tension strain

!! -- orthotropic linear material --
!! mp, alp{x,y,z}, Steel, val
!! mp, e{x,y,z}, Steel, val

!! --- Elastomers (hyperelastic) ---
!! Rubber = 3
!! tb,hyper,Rubber,,,MOONEY
!! Shore = 60
!! ShearModule = 0.086*1.045**Shore
!! tbdata,1,3*ShearModule/6.6
!! tbdata,2,.3*ShearModule/6.6
!! -- check whether to drop elem. midside nodes and use u-p formulation
!! keyopt,Rubber,6,1		 !(6)1: mixed u-p formulation
!! ! ogden for high strain applic. (700 % strain)
!! tb,hyper,Rubber,,,OGDEN

!! --- Magnetic materials ---
!! Air = 4
!! mp,murx,Air,1 ! murx permeability
!! Magnet = 5
!! Hc = 2.8e5 ! ferrit magnet coercive force in A/m
!! mp,mgxx,Magnet,Hc 
!! Pi = acos(-1)
!! Mu0 = .4*Pi*1e-6 ! field constant in Vs/(Am)
!! Br = .4 ! residual induction in Tesla
!! mp,murx,Magnet,Br/(Mu0*Hc)

!! /pnum,mat,1 $ eplot
!! ------------------------------
!@@ -- element definition --

ID=Steel
et,ID,solid186 !3d, 20 node
etlist !list defined elements
!! et,ID,solid185 !3d, 8 node
!! et,ID,plane183,,,0 !2d, 8 node (3)0:plane stress, 1:axissymmetric
!! et,ID,plane182 !2d, 4 node
!! keyopt,ID,3,1 !(3)=0:plane stress,1:axissym,2:plain strain.
!! keyopt,ID,1,0 !(1)=0:reduced integr.2:enhanced strain for bending
!! !!for most elements the radial direction is the x-axis
!! --- magnetics ---
!! et,ID,plane13 !2d, legacy coupled-field ->plane53
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,5,2 !(5)=2:nodal magnetic field printout
!! et,ID,infin110 !2d semi infinit electromagnetic elem.
!! !only 1 element layer, sized in the order of the problem domain
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,2,1 !(2)=0:4-node,1:8-n
!! --- assign attributes ---
!! aatt,MAT,REAL,TYPE ! associate prop. with selected areas

!! /pnum,type,1 $ eplot ! display materials
!! ------------------------------
!@@ -- meshing --

!! mat,Steel
!! mshkey,1 !1: mapped meshing,2: mapped if possible
!! mshape,0 !0: quads 1:tri (supported shapes)
esize,1 ! element edge length
!! lesize,all,,,3 ! SPACE neg: center to end division
!! ! vmesh,all
!! amesh,all
!! -- cyclic symmetric meshing --
!! cyclic ! check sectors in case of cyclic sym.
!! *status ! look for CYCLIC_XREF
!! cyclic,status
!! /cycexpand ! expand graphics rep.

!! /pnum,mat,1 $ eplot
!@@ -- boundary conditions --

/prep7

!kbc,1 ![0] (antype,static): ramped 1:stepped loading

!@@@ - displacements -

!nsel,s,loc,y,0
!    ,a,loc,y,1
!    ,r,loc,x,0
d,all,all
!dlist,all

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++!! (setq font-lock-maximum-decoration '((ansys-mode . 1)))
!(progn (unload-feature 'ansys-mode)(load-file "ansys-mode.el")(ansys-mode))
f
fi
fin
fini
finis 
finish
finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Copper= 3
False = 0$True =1
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans  '_otto'	 ! _vars: macro reserved words
*afun,rad
!! APDL get/parametricfunctions & old style (deprecated) Anys comments
var1=sinh(nx(.3 *5)) !old style Ansys comments!!!!!
var2 = tanh(cos(.3*5)) !not an old style Ansys comment
!! undocumented commands
/xml
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular
/com,hans holz ! this is really no comment
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Icoil = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands without arguments
/prep7 $ finish
/prep7 !nothing behind
/prep7 nothing behind
rect,X1,_X2,Y1,Y2 ! 2d rectangle
nsel,s,loc,y,0
    ,a,loc,y,1
d,all,all
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,10
*endif
!! implicit (colon) looping
lfillt,(1:2),(3:4),5
*dowhile,PAR
*cycle, bla _bla
*cyc
  *exit
*enddo
! goto branching
*go,:BRANCH
:BRANCH
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
vvv!! ====================
 
alsalsdkfjaölsdkfjaölskdjf 
nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------
!@@ -- cad import -- 

/aux15
ioptn,iges,nodefeat
ioptn,merge,yes
ioptn,solid,yes
ioptn,small,yes
ioptn,gtoler,defa
igesin,'test','iges'

/input,filename,anf ! for APDL based input
/facet,norm
!! ------------------------------
!@@ -- configurations --

! *afun,deg ! trig. functions accept angle arguments
*afun,rad
True = 1
False = 0

/title,
/plopts,wp,1 !display working plane
/triad,rbot !off, orig, ltop, ...
!/cwd,DIR !changes working directory
!! ------------------------------
!@@ -- geometry --

/prep7
rectng,X1,X2,Y1,Y2 ! 2d rectangle
!!arsym,y,all ! reflection of areas Xc = 0
Yc = 0
R1=4
R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder
!shpere,rad1,rad2,th1,th2 !spherical volume

!@@@ - booleans -

!! aovlap,all ! overlap areas
!! asba,A1,A2,SEPO,KEEP1,KEEP2 ! SEPO: seperate entities
!! asbw, !substract by wp
!! /pnum,area,1 $ aplot
!! vdele,all,,,1 !skwp 1:delete kp,l,a as well
!@@ -- material definitions --

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
!mplist,all
!! mpplot !plots mat. against temperature
!! tb,biso,Steel,1 ! bilinear isotropic plasticity
!! yield_stress=140
!! tangent_modulus=1400
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
!! Alu=2
!! mp,nuxy,Alu,0.3
!! mp,ex,Alu,70000
!! tb,biso,Alu,1
!! !! tbdata,,yield_stress,tangent_modulus !biso
!! /com, === Material %Alu% is Aluminium. ===
!! --- hyperelastic mooney rivlin mat ---
!! for 30 % compression 100 % tension strain

!! -- orthotropic linear material --
!! mp, alp{x,y,z}, Steel, val
!! mp, e{x,y,z}, Steel, val

!! --- Elastomers (hyperelastic) ---
!! Rubber = 3
!! tb,hyper,Rubber,,,MOONEY
!! Shore = 60
!! ShearModule = 0.086*1.045**Shore
!! tbdata,1,3*ShearModule/6.6
!! tbdata,2,.3*ShearModule/6.6
!! -- check whether to drop elem. midside nodes and use u-p formulation
!! keyopt,Rubber,6,1		 !(6)1: mixed u-p formulation
!! ! ogden for high strain applic. (700 % strain)
!! tb,hyper,Rubber,,,OGDEN

!! --- Magnetic materials ---
!! Air = 4
!! mp,murx,Air,1 ! murx permeability
!! Magnet = 5
!! Hc = 2.8e5 ! ferrit magnet coercive force in A/m
!! mp,mgxx,Magnet,Hc 
!! Pi = acos(-1)
!! Mu0 = .4*Pi*1e-6 ! field constant in Vs/(Am)
!! Br = .4 ! residual induction in Tesla
!! mp,murx,Magnet,Br/(Mu0*Hc)

!! /pnum,mat,1 $ eplot
!! ------------------------------
!@@ -- element definition --

ID=Steel
et,ID,solid186 !3d, 20 node
etlist !list defined elements
!! et,ID,solid185 !3d, 8 node
!! et,ID,plane183,,,0 !2d, 8 node (3)0:plane stress, 1:axissymmetric
!! et,ID,plane182 !2d, 4 node
!! keyopt,ID,3,1 !(3)=0:plane stress,1:axissym,2:plain strain.
!! keyopt,ID,1,0 !(1)=0:reduced integr.2:enhanced strain for bending
!! !!for most elements the radial direction is the x-axis
!! --- magnetics ---
!! et,ID,plane13 !2d, legacy coupled-field ->plane53
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,5,2 !(5)=2:nodal magnetic field printout
!! et,ID,infin110 !2d semi infinit electromagnetic elem.
!! !only 1 element layer, sized in the order of the problem domain
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,2,1 !(2)=0:4-node,1:8-n
!! --- assign attributes ---
!! aatt,MAT,REAL,TYPE ! associate prop. with selected areas

!! /pnum,type,1 $ eplot ! display materials
!! ------------------------------
!@@ -- meshing --

!! mat,Steel
!! mshkey,1 !1: mapped meshing,2: mapped if possible
!! mshape,0 !0: quads 1:tri (supported shapes)
esize,1 ! element edge length
!! lesize,all,,,3 ! SPACE neg: center to end division
!! ! vmesh,all
!! amesh,all
!! -- cyclic symmetric meshing --
!! cyclic ! check sectors in case of cyclic sym.
!! *status ! look for CYCLIC_XREF
!! cyclic,status
!! /cycexpand ! expand graphics rep.

!! /pnum,mat,1 $ eplot
!@@ -- boundary conditions --

/prep7

!kbc,1 ![0] (antype,static): ramped 1:stepped loading

!@@@ - displacements -

!nsel,s,loc,y,0
!    ,a,loc,y,1
!    ,r,loc,x,0
d,all,all
!dlist,all

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++
!! (setq font-lock-maximum-decoration '((ansys-mode . 1)))
!(progn (unload-feature 'ansys-mode)(load-file "ansys-mode.el")(ansys-mode))
f
fi
fin
fini
finis 
finish
finisher
!! variables max. 32 chars long & condensed ($) input lines
v123456789_123456789_123456789_123= 1 $ Alu=2 $ Copper= 3
False = 0$True =1
_bla = 3		 ! _vars: macro reserved words
nsel,s,_hans  '_otto'	 ! _vars: macro reserved words
*afun,rad
!! APDL get/parametricfunctions & old style (deprecated) Anys comments
var1=sinh(nx(.3 *5)) !old style Ansys comments!!!!!
var2 = tanh(cos(.3*5)) !not an old style Ansys comment
!! undocumented commands
/xml
/fil $ /filname
!! string, message commands and comment behaviour && %$$% %% :: &&&
igesin,'test','%iges%'
/titl,Nothing in particular
/com,hans holz ! this is really no comment
c*** otto !otto otto %neither% here !!!!!!!
/sys,ls "*.mac"
!! multiline message format command this is tricky: use M-o M-o
*MSG,UI,Vcoilrms,THTAv,Icoilrms,THTAi,Papprnt,Pelec,PF,indctnc
Coil RMS voltage, RMS current, apparent pwr, actual pwr, pwr factor: %/ &
Icoil = %G A (electrical angle = %G DEG) %/ &
_Power factor: %G %/ &
Inductance = %G %/ &
VALUES ARE FOR ENTIRE COIL (NOT JUST THE MODELED SECTOR)
this is not any longer in the *msg format construct
/com this is not any longer in the *msg format construct
*vwrite,B(1,1),B(2,1),_bla
alkd %D &
%E%/%E
!! commands without arguments
/prep7 $ finish
/prep7 !nothing behind
/prep7 nothing behind
rect,X1,_X2,Y1,Y2 ! 2d rectangle
nsel,s,loc,y,0
    ,a,loc,y,1
d,all,all
!! element types & deprecated element types
et,Steel,beam3 $ et,Alu,shell91
!! control constructs
*if,I,eq,1,then
*elseif,I,le,10
*endif
!! implicit (colon) looping
lfillt,(1:2),(3:4),5
*dowhile,PAR
*cycle, bla _bla
*cyc
  *exit
*enddo
! goto branching
*go,:BRANCH
:BRANCH
/eof === WARNING: /eof crashes Ansys GUI in interactive mode ===
vvv!! ====================
 
alsalsdkfjaölsdkfjaölskdjf 
nsel,s,loc,x,1
    ,s,loc,x,1
cp,next,uy,all !couple dofs
f,1,fx,1
!flist ! list force nodes
allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! ------------------------------
!@ --- header ---
!! ------------------------------
!! FILENAME: fontification.mac
!! CREATION DATE: Wed Dec 23 15:13:39 2009
!! ANSYS VERSION: 12.0
!! DESCRIPTION: alsdkf
!! ------------------------------
!@@ -- cad import -- 

/aux15
ioptn,iges,nodefeat
ioptn,merge,yes
ioptn,solid,yes
ioptn,small,yes
ioptn,gtoler,defa
igesin,'test','iges'

/input,filename,anf ! for APDL based input
/facet,norm
!! ------------------------------
!@@ -- configurations --

! *afun,deg ! trig. functions accept angle arguments
*afun,rad
True = 1
False = 0

/title,
/plopts,wp,1 !display working plane
/triad,rbot !off, orig, ltop, ...
!/cwd,DIR !changes working directory
!! ------------------------------
!@@ -- geometry --

/prep7
rectng,X1,X2,Y1,Y2 ! 2d rectangle
!!arsym,y,all ! reflection of areas Xc = 0
Yc = 0
R1=4
R2=20
N = 14.
Alpha1=-360./(2*N)
Alpha2=+360./(2*N)
Depth=30
cyl4,Xc,Yc,R1,Alpha1,R2,Alpha2,Depth ! circular area or cylinder
!shpere,rad1,rad2,th1,th2 !spherical volume

!@@@ - booleans -

!! aovlap,all ! overlap areas
!! asba,A1,A2,SEPO,KEEP1,KEEP2 ! SEPO: seperate entities
!! asbw, !substract by wp
!! /pnum,area,1 $ aplot
!! vdele,all,,,1 !skwp 1:delete kp,l,a as well
!@@ -- material definitions --

Steel=1
mp,nuxy,Steel,0.3 ! Poisson No
mp,ex,Steel,200000 ! Elastic modulus
!mplist,all
!! mpplot !plots mat. against temperature
!! tb,biso,Steel,1 ! bilinear isotropic plasticity
!! yield_stress=140
!! tangent_modulus=1400
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
!! Alu=2
!! mp,nuxy,Alu,0.3
!! mp,ex,Alu,70000
!! tb,biso,Alu,1
!! !! tbdata,,yield_stress,tangent_modulus !biso
!! /com, === Material %Alu% is Aluminium. ===
!! --- hyperelastic mooney rivlin mat ---
!! for 30 % compression 100 % tension strain

!! -- orthotropic linear material --
!! mp, alp{x,y,z}, Steel, val
!! mp, e{x,y,z}, Steel, val

!! --- Elastomers (hyperelastic) ---
!! Rubber = 3
!! tb,hyper,Rubber,,,MOONEY
!! Shore = 60
!! ShearModule = 0.086*1.045**Shore
!! tbdata,1,3*ShearModule/6.6
!! tbdata,2,.3*ShearModule/6.6
!! -- check whether to drop elem. midside nodes and use u-p formulation
!! keyopt,Rubber,6,1		 !(6)1: mixed u-p formulation
!! ! ogden for high strain applic. (700 % strain)
!! tb,hyper,Rubber,,,OGDEN

!! --- Magnetic materials ---
!! Air = 4
!! mp,murx,Air,1 ! murx permeability
!! Magnet = 5
!! Hc = 2.8e5 ! ferrit magnet coercive force in A/m
!! mp,mgxx,Magnet,Hc 
!! Pi = acos(-1)
!! Mu0 = .4*Pi*1e-6 ! field constant in Vs/(Am)
!! Br = .4 ! residual induction in Tesla
!! mp,murx,Magnet,Br/(Mu0*Hc)

!! /pnum,mat,1 $ eplot
!! ------------------------------
!@@ -- element definition --

ID=Steel
et,ID,solid186 !3d, 20 node
etlist !list defined elements
!! et,ID,solid185 !3d, 8 node
!! et,ID,plane183,,,0 !2d, 8 node (3)0:plane stress, 1:axissymmetric
!! et,ID,plane182 !2d, 4 node
!! keyopt,ID,3,1 !(3)=0:plane stress,1:axissym,2:plain strain.
!! keyopt,ID,1,0 !(1)=0:reduced integr.2:enhanced strain for bending
!! !!for most elements the radial direction is the x-axis
!! --- magnetics ---
!! et,ID,plane13 !2d, legacy coupled-field ->plane53
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,5,2 !(5)=2:nodal magnetic field printout
!! et,ID,infin110 !2d semi infinit electromagnetic elem.
!! !only 1 element layer, sized in the order of the problem domain
!! keyopt,ID,3,1 !(3)=1:axissym.
!! keyopt,ID,2,1 !(2)=0:4-node,1:8-n
!! --- assign attributes ---
!! aatt,MAT,REAL,TYPE ! associate prop. with selected areas

!! /pnum,type,1 $ eplot ! display materials
!! ------------------------------
!@@ -- meshing --

!! mat,Steel
!! mshkey,1 !1: mapped meshing,2: mapped if possible
!! mshape,0 !0: quads 1:tri (supported shapes)
esize,1 ! element edge length
!! lesize,all,,,3 ! SPACE neg: center to end division
!! ! vmesh,all
!! amesh,all
!! -- cyclic symmetric meshing --
!! cyclic ! check sectors in case of cyclic sym.
!! *status ! look for CYCLIC_XREF
!! cyclic,status
!! /cycexpand ! expand graphics rep.

!! /pnum,mat,1 $ eplot
!@@ -- boundary conditions --

/prep7

!kbc,1 ![0] (antype,static): ramped 1:stepped loading

!@@@ - displacements -

!nsel,s,loc,y,0
!    ,a,loc,y,1
!    ,r,loc,x,0
d,all,all
!dlist,all

!@@@ - loads -

!f,all,fx,1
!flist,all

!@@@ - inertia relief -

!! LOADS: nonlinearities aren't supported, fix all DOFs!
!! irlf,1 !0: none,1:ir on,-1:printout masses
nsel,s,loc,x,1

!@@@ - corriolis effects -

!! cgmga,x,y,z, ! rotational velocity about globla coord. sys.
!! dcgomg,x,y,z ! rotational acceleration about global coord. sys.

!@@@ - coupling -
nsel,s,loc,x,1
cp,next,uy,all !couple dofs

allsel
/pbc,all,on
!gplot

!@@@ - magnetics -

!! fmagbc,'Component' ! flag force calculation
!! bfa,all,js, ! js current density
!bflist,all
!! dl,all,,asym ! flux parallel to lines
!! nsel,s,ext ! select exterior nodes
!! dsym,asym ! flux parallel to lines
!! ------------------------------
!@ --- solution --- 
!! ------------------------------

/solu
allsel

!! solcontrol,on! optimised nonlinear solution defaults
!! n1=20
!! n2=n1*100
!! n3=n1/4
!! nsubst,n1,n2,n3
!! outres,all,all
!! !antype,,rest, !perform restart operation
!! nlgeom,on
!! autots,on

solve

!! cnvtol,u,,0.1! convergence [0.5 % solcontrol, on: 5 %] manipulation
!! cnvtol,f,,0.05 !solcontol,on: [0.5% F,M; 5% U]
!! neqit,30! No of equilibr. iterations!! nldiag,nrre,on! store residual file
!! nldiag,maxf,2! maximum files written
!! rescontrol,,1,last !create restart file(s)
!!           ,status
!! /config,nres,2000 !No of substeps in result file [1000]
/solu

!! nlhist,on !nonlinear tracking in .nlh
!! eqslv,pcg,1e-4
!! nropt,unsym !frictional contacts not converging?
!! coupling of sliding and normal stiffness
!! stabilize,constant,energy,1e-4
!! !stabilize,off !reduce
!! !arclen,on ! arclen stabilisation

!! /runst !enter the run statistics processor
!! rall !run statistics estimator

!! rescontrol,file_summary !check restart files
!! antyp,,rest,1,last
!! time,1.2 !time at the end of load step

!@@ -- magnetics --

!! magsolv

!@@ -- cyclic symmetry --

!! cycopt,status
!! ------------------------------
!@ --- post 1 ---
!! ------------------------------

/post1
set,last
plnsol,u,sum,2 !0:deformed only, 1:with undef model 2:with undeformed edges
!plnsol,s,eqv ! von Mises
!plnsol,s,1 ! maximum principle: Lamé
!plnsol,s,int ! stress intensity: Tresca
!plnsol,s,xy ! shear in xy-dir.

!! /dscale,,1 !do not scale (for nlgeom)
!! /dscale,,auto !or 0:scale automatically
!! !*get,Ds,graph,WN,dscale,dmult
!! /contour,,ncont,min,inc,max
!! /contour,,auto !switch off user contours
!! /edge,,1 !1:display elements in contour plots
!! /edge,,0 !0:switch off display of elements in contour plots
!! /plopts,minm,off !switch off min-max symbols
!! /plopts,minm,on
!! /pbc,rfor,,1 !1:show reaction f. symbols
!! /pbc,rfor,,0
!! /dist,,1/2,1 !enlarge twice
!! /noerase ! don't erase screen between plots
!! erase!! /triad,rbot ! coordinate system to right bot
!! /plopts,wp ! switch off working plane
!! /plopts,minm ! switch off min max

!! -- graphics output & invert background colour --
!/RGB,index,100,100,100,0
!/RGB,index,0,0,0,15
!/show,png !creates jobnameXXX.png files
!pngr !additional options
!plvect,B
!noerase
!lplot
!/show,close
!erase

/efacet,2
!psdisp,0
!/graphics,full ! results averaging also from interior
!pletab,Pene
plls,Pene,Pene !line element results
!!! --- magnetics ---
!! plf2d,27 ! flux lines, equipotentials
!! plvect,b,! induction vector plot
!! fmagsum,'component_name'

nldpost,nrre,stat !element information nonlinear
plnsol,nrre,,,,001 !plot residual file .nr001 
!! etable,Pene,cont,pene
!! etable,chat,cont,cnos
!! etable,cpre,cont,pres
!! etable,Slid,cont,slide
!! etable,St,cont,stat	 !3-closed sticking
!! 			 !2-closed sliding
!! 			 !1-open but near
!! 			 !0-open and far, outside pinball
set,list
set,last!first
plnsol,s,1
!antime
!andata
!anmres !multiple result files

!! cycexpand,on ! graphical expansion
finish
/clear

press=3

daou = 33.6! max housing outer diam
radi = .5 ! housing radius
rad2 = .2 ! base radius
diam = 1.5 !o-ring diameter
diab = 32.8 ! min base outer diam
dib2 = 29.6 ! inner base diam
disp = diam - 1.2 !pre-deformation
/prep7
!housing k point before radius
n,1,daou/2 - radi,0
n,2,daou/2,radi
n,3,daou/2 - radi,radi !centre


real,1
et,1,targe169
tshap, arc
e,2,1,3
tshap, line
!housing base
n,4,daou/2 - diam, 0
e,1,4
!housing side
n,5,daou/2, diam + rad2
e,5,2
real,2
!base
n,6,diab/2 - rad2, diam
n,7,dib2/2, diam
e,7,6
!pilot element
tshap,pilo
e,7
!base radius
tshap,carc
n,8,diab/2,diam + rad2
n,9,diab/2 - rad2, diam + rad2
e,6,8,9
!base side
n,10,diab/2,diam + rad2 + rad2
tshap, line
e,8,10
!o-ring
et,3,hyper56
KEYOPT,3,3,1
cyl4,daou/2-diam/2,diam/2,diam/2
type,3
esize,diam/20
amesh,all

TB,MOONEY,1
MPTEMP,1,0  
MPDATA,MU,1,,.5 
mp,nuxy,1,0.499 
G_MODUL=0.94  !(N/mm**2)   !Shore-Haerte A 60
!G_MODUL=1.09  !(N/mm**2)   !Shore-Haerte A 64
!G_MODUL=1.35  !(N/mm**2)   !Shore-Haerte A 70
!G_MODUL=1.87  !(N/mm**2)   !Shore-Haerte A 80
!Mooney-Rivlin 2 Param nur aus G_MODUL
!Rezept von Hrn Dutly (ueber Hrn. Urban, Fa. Boge)
!/////////////////////////////
c1=3*G_MODUL/6.6
c2=0.1*C1
tbdata,1,c1
tbdata,2,c2 
!contacts

et,2,conta171
type,2

nsel,s,loc,y,6*diam/7,1e3
nsel,
esln,s,
eplot
esurf
nsel,inve
esln,s
real,1
esurf
!bc

allsel
d,7,uy,-disp
allsel
lswrite,1
lsel,s,,,2,3
nsll,s,1
sf,all,pres,press
allsel
lswrite,2
/SOLU    
ANTYPE,0
NLGEOM,1
NSUBST,10,100,1 
AUTOTS,1
EQSLV,PCG,1E-5  

lssolve,1,2
save
!------------------------------
/post1
set,last



!esel,s,real,,2
!esel,u,type,,3

!* 3d stress concentration in a symmetric
!* notched bar
!* with bending moments
!^ y
!| ------ l -----   >|
!|----------------|
!|     	       	t | radius rho
!|	       ____\______
!|	    	     | 	a
!|___________________|____  --> x

!************************************
   
fini
/clear
/filname,concentr_bending
/graphics,full!for error estimation
!* geometry in mm
l=15
t=5
rho=t/2
thic=20*rho
a=t
forc=0!per unit length
p=100!for the torque
end=2!loop end
/prep7

rectng,0,l,0,t+a
rectng,l-rho,l,a+rho,t+a
asba,1,2,,delete
wplane,1,l,a+rho
pcirc,rho
asba,3,1

!well we have to change the mesh later on
wplane,1,l,0
csys,wp
arsym,y,all


!* solid
et,1,plane183 !* 2d 2-D 8-Node Structural Solid
et,2,solid186 !* 3d 20-node elem
type,1
mp,ex,1,200000
mp,nuxy,1,.3

pi=acos(-1)
!------------- bricks -----------
*cfopen,3d_quads_bend,txt,,

*do,de,1,end
   /prep7
   vclear,all
   vdele,all
   asel,u,,,1,2
   adele,all,,,1!and everything below
   allsel
   vext,all,,,0,0,thic/de
   nummrg,all
   !------- bc ------
   
   !symmetry between the notch grooves
   wpcsys,1,0
   asel,s,loc,x,l,1e3
   da,all,ux,0
   lsel,s,loc,x,l
   lsel,r,loc,y,0
   dl,all,,uy,0
   !z-symmetry
   asel,s,loc,z,0
   da,all,uz,0
   allsel
   
   !loads
   peff1=-forc+p
   peff2=-forc-p
   asel,s,loc,x,0
   asel,r,loc,y,0,1e3
   sfa,all,,pres,peff1
   asel,s,loc,x,0
   asel,r,loc,y,0,-1e3
   sfa,all,,pres,peff2
   allsel

   *do,ed,1,end
      /prep7
      nn=2*ed+1!no of nodes at radius
      /title, "stress concentration, %nn% nodes"
      allsel
      vclear,all
      lesize,12,,,ed
      lesize,5,,,ed
      lesize,23,,,ed
      lesize,11,,,ed
      lesize,3,,,ed
      esize,1.5*2*rho/4*pi/ed
      !aesize
      mshape,0!quads
      !asel,s,loc,z,0
      !amesh,all

      !type,
      allsel
      extopt,aclear,1!clear areas
      extopt,vswe,auto,on
      extopt,esize,2
      vsweep,all

      /edge,1,1
      allsel
      nummrg,all
      /solu
      EQSLV,PCG,1E-6
      outres,all,all
      solve
      !------------------------------
      /post1
      set,last
      tmp=node(l,-a,0)
      *get,bla,node,tmp,s,eqv!averaged node res
      nsel,s,,,tmp
      esln,s,0
      ee=elnext(1)
      !presol
      allsel
      plnsol,s,eqv
      *get,otto,elem,ee,sdsg
      *get,blabla,plnsol,,bmax
      stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,aspect ratio
      *vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla,thic/de!only batch!
%I %G %G %G %G %G %G
   *enddo
*enddo
*cfclos

/eof

!============================== triangles 
*cfopen,3d_triangles_bend,txt,,
lesize,all,,,-1,,1!clear all lesizes

*do,ed,1,end
/prep7
vclear,all
lesize,all,,,-1,,1!clear all lesizes
!lsel,s,loc,z,thic/2
!lesize,all,,,ed
nn=2*ed+1!no of nodes at radius
/title, "stress concentration, %nn% nodes"
esize,1.5*2*rho/4*pi/ed
lsel,s,loc,z,thic/2
lesize,all,,,ed
mshape,1!triangles!
allsel
vmesh,all

/edge,1,1
/solu
outres,all,all
EQSLV,PCG,1E-4
solve

/post1
set,last
tmp=node(l,a,0)
*get,bla,node,tmp,s,eqv
nsel,s,,,tmp
esln,s,0
ee=elnext(1)
allsel
plnsol,s,eqv
*get,otto,elem,ee,sdsg
*get,blabla,plnsol,,bmax
stress=2*forc+3/2*p*((a+t)/a)**2
!node,seqv,relative str,error estim,
*vwrite,nn,bla,bla/stress,otto/stress,blabla/stress,blabla!only batch!
%I %G %G %G %G %G
*enddo
*cfclos

!------------------------------
/eof

/post1
wpoffs,l
!wpstyl,,,,,,1!cylindric
cswpla,11,1
csys,11
/expand,2,lpolar,,0,10,1e-3
/replot
!@ ********* first line ***************
!! FILENAME: c:/cygwin/home/dieter/equivalent_stresses/equivalent_stresses.mac
!! Creation DATE: Mon Jul 03 17:53:14 2006
!! Ansys VERSION: 11.0 Release
!! DESCRIPTION: influence of friction in an axialsymmetric compression test
!! ------------------------------
!! COMMENTARY: User parameters start with upper case.
!!  Ansys command names may be ommitted (defaulting to the
!!  previous command, except slash and asterisk commands).
!! WARNING: Variables starting with an underscore are reserved
!!  (for Ansys GUI components and Ansys furnished macros)!

!! ==============================
!@ --- Setup ---
!! ==============================

finish $ /clear

*get,Wallstrt,active,,time,wall
c*** Configuring for 2 processors does not harm when only 1 is present
/config,nproc,2
/uis,msgpop,3 !3: No warning popup boxes
*afun,deg !trig. fun with degree input/title,
*afun,rad
/plopts,wp,1 !display working plane
/triad,rbot
!! /output, !change solver output file
!! /input,

!! ==============================
!@ --- Preprocessing ---
!! ==============================

!! ------------------------------
!@@ --- Cad Import ---
!! ------------------------------

!! /aux15
!! ioptn,iges,nodefeat
!! ioptn,merge,yes
!! ioptn,solid,yes
!! ioptn,small,yes
!! ioptn,gtoler,defa
!! igesin,'test','iges'

!! /input,fname,anf
!! /facet,norm

!! ------------------------------
!@@ --- General Preprocessing ---
!! ------------------------------

/prep7
Pi=3.14159265359

!! /pnum,area,1

!! --- Material and element types ---
Steel=1
Alu=2
Contact = 3
Target = 4
mp,nuxy,Steel,0.3
mp,ex,Steel,200000
!! tb,biso,Steel,1
!! tbdata,,yield_stress,tangent_modulus !biso
/com, === Material %Steel% is steel. ===
et,Steel,plane182 !2d, 4 node
keyopt,Steel,3,1 !1:axissym.

mp,nuxy,Alu,0.3
mp,ex,Alu,70000
tb,biso,Alu,1
tbdata,,120,20000 !biso!!
/com, === Material %Alu% is Aluminium. ===
et,Alu,plane182 !2d 4 node
keyopt,Alu,3,1 !0:plane stress, 1:axissym.

!! ! --- Contacts ---
r,Contact
!! et,Contact,conta174 !3d, 8 node
!! !! et,Contact,conta173, !3d, 4 node
!! et,Target,targe170 !3d
!! !! et,Contact,conta172 !2d, 3 node
et,Contact,conta171 !2d, 2 node
et,Target,targe169 !2d
keyo,Contact,10,2 !contact stiffness update, 2: each NR iteration, 1: each substep
keyo,Contact,12,0 !contact behaviour, 0: standard
keyo,Contact,9,1 !initial penetration, 1:ignore initial gaps/penetr
keyo,Contact,5,1 !initial contact closure, 1:auto CNOF adjustment to close geometric gap only
real,Contact
rmod,Contact,3,100 !FKN: normal penalty stiffness factor
rmod,Contact,5,0.0 !ICONT: amount of initial contact closure (positiv: penetration)
rmod,Contact,6,-0.1 !PINB: pinball radius (negativ means no scaling: absolute distance)
rmod,Contact,10,0. !CNOF: contact surface offset
mp,mu,Contact,0.4 !friction factor
rmod,Contact,12,0. ! FKT: tangent stiffness factor, 0:means 1 for Ansys!!!

!! --- Geometry ---

!! |
!! :
!! |_____r2_____
!! :     	     |
!! |     	     | h2
!! :------------
!! |     	 |
!! :     	 |  h1
!! |--------|
!! :   r1
!! |

r1=5/2
r2=2*r1
h1=r1
h2=h1

rectng,0,r1,-h1,0 !x1,x2,y1,y2
rectng,0,r2,0,h2

!! refinement area
cl=r1/10
rectng,r1-cl/2,r1+cl/2,-cl/2,cl/2

/pnum,area,1
aplot
aptn,2,3
adele,4,,,1
rectng,r1-cl/2,r1,-cl/2,0
aptn,1,2

!! aglue,6,8
!! aglue,4,7
!! /number,1 !0: colour and number,1: colour
!! /pnum,line,1 !1: turn on numbering
!! lplot
!! lesize,1,,,3

!! --- Meshing ---
/pnum,line,1
lplot

lesize,14,,,10,5
lesize,13,,,10,5
lesize,15,,,20,-1/5
!! tool
mat,Steel
mshkey,0 !1: mapped meshing,2: mapped if possible
esize,cl/10
amesh,5
!! mshape,0 !0: quadrilaterals
esize,cl/2
amesh,6

!! specimen
mat,Alu
esize,cl/10
amesh,3
esize,cl/2
amesh,4

!! -- Contacts
real,Contact
mat,Contact

!! Alu
type,Contact
nsel,s,loc,y,0
esln,s
esel,r,mat,,Alu
esurf !,,reverse

!! Steeel
type,Target
nsel,s,loc,y,0
esln,s
esel,r,mat,,Steel
esurf !,,reverse

!! cncheck !initial contact status

!! --- Boundary conditions ---

!! symmetry
nsel,s,loc,y,-h1
d,all,uy,0

!! tool
nsel,s,loc,y,h2
cp,next,uy,all
P=270
F=Pi*r1*r1*P
nsel,r,loc,x,0
f,all,fy,-F
allsel

!! ==============================
!@ --- Solution ---
!! ==============================

/solu

solcontrol,,on, ! ,,check contact state,pressure load stiffness
n1=20
n2=n1*100
n3=n1/4
nsubst,n1,n2,n3
outres,all,all
nlgeom,on
autots,on
 
!! rescontrol,,all,1 !restart files
!! eqslv,pcg,1e-4
!! cnvtol,f,,0.1
!! nropt,unsym !frictional contacts no converging?
!! coupling of sliding and normal stiffness

/eof !------------------------------

*get,Wallbsol,active,,time,wall
solve $ save $ finish

*get,Walldone,active,,time,wall
Preptime=(Wallbsol-Wallstrt)*60
Solvtime=(Wallasol-Wallbsol)*60
Totaltim=(Walldone-Wallstrt)
*msg,ui,Preptime,Solvtime,Totaltim
Time in min for preprocessing: %G %/ &
Time in min for Solving: %G %/ &
Total time in h: %G %/ &
=== End of timing messages ===

!! ==============================
!@ --- Postprocessing ---
!! ==============================

!! ------------------------------
!@@ --- General Postprocessing ---
!! ------------------------------

!! /dscale,,1
!! /contour,,ncont,min,inc,max
!! /contour,,auto
!! /edge,,1 !1:display all lines in contour plots
!! /edge,,0
!! /plopts,minm,off !switch off min-max symbols
!! /pbc,rfor,,1 !1:show reaction f. symbols
 
/post1
set,last
/efacet,2
!plesol,epto,eqv
!plesol,eppl,eqv
/dscale,,5
esel,s,mat,,Alu
plesol,s,3

!! --------- etables ----------
!! etables don't take into account higher element order

!! ---- Mohr-Coulomb failure criterion
Z1 = 180 !tensile strength
Z3 = 270 !compressive strength
etable,S1,s,1
etable,S3,s,3
sadd,Z,S1,,1e-16
smin,S3,S3,Z
sadd,R,S1,S3,1/Z1,-1/Z3
pletab,R,avg

esort,etab,R
*get,Mc,etab,sort,,max" 
*msg,,Mc
Mohr-Coulomb criterion (< 1): %G

!! --- Reactions
Ls=1
set,Ls
*get,Ns,active,,solu,ncmss !number of substeps
*get,Dim,parm,Reaction,dim,x
*if,Dim,le,1,then
  *dim,Reaction,array,Ns,1
*endif
*do,I,1,Ns
  set,Ls,I
  fsum
  *get,Fx,fsum,,item,fx
  Reaction(I)=Fx
*enddo
v/gcolumn,1,'Reaction'
/axlab,x,Substep
/axlab,y,Force in N
*vplot,,Reaction

!! --- Animation
/seg,multi,process,0.15 !process.avi, delay .15
Ls=1
set,LS
*get,Ns,active,,solu,ncmss !number of substeps
*do,I,1,Ns
  set,Ls,I
  plnsol,s,eqv
*enddo
/seg,off,process,.15

!! ------------------------------
!@@ --- Time-History Postprocessing ---
!! ------------------------------

/post26
!! esol,2,1,u,z
nsol,2,1,u,z
rforce,3,1,f,z
!! add,4,2,,,displ,,,-1
/grid,1
/gmarker,1,1 !curve marking: 1: triangles,2: squares
!! /xrange,0,1
!! /xrange,default
!! /yrange,0,1
!! /axlab,x,x
!! /axlab,y,y
!! timerange,0,1
!! /title,
xvar,2
plvar,3
!!prvar,3

!@ +++++++++ last line +++++++++++++